CatSimulator={add:function(a,b){if(this.hasOwnProperty(a))throw new Error("Poor cat can't take this anymore!");this[a]=b,b.hasOwnProperty("onAdd")&&b.onAdd.call(this)}},CatSimulator.Action=function(a,b){this.message=a,this.parameters=b},CatSimulator.Action.prototype={minEnergy:10,maxEnergy:25,minHunger:0,maxHunger:10,estimate:function(){var a=CatSimulator.Cat.getParameters(),b=CatSimulator.Cat.survive(a);for(var c in this.parameters)this.parameters.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(b[c]+=this.parameters[c]);var d=b.speed*b.speed+(b.energy>this.minEnergy?1:-5)+(b.hunger<this.maxHunger?1:-5);return Math.max(d,0)},perform:function(){for(var a in this.parameters)this.parameters.hasOwnProperty(a)&&CatSimulator.Cat.parameters.hasOwnProperty(a)&&(CatSimulator.Cat.parameters[a]+=this.parameters[a]);CatSimulator.Cat.parameters.energy=Math.min(CatSimulator.Cat.parameters.energy,this.maxEnergy),CatSimulator.Cat.parameters.hunger=Math.max(CatSimulator.Cat.parameters.hunger,this.minHunger)}},CatSimulator.Actions={choose:function(){var a=[],b=0;for(var c in this.list)this.list.hasOwnProperty(c)&&a.push(this.list[c].estimate());for(var d=0;d<a.length;d++)this.prefer(a[d],a[b])&&(b=d);return this.list[b]},prefer:function(a,b){var c=a/(a+b);return Math.random()<c},list:[new CatSimulator.Action("SLEEP",{hunger:-.5,energy:5}),new CatSimulator.Action("EAT",{hunger:-5,energy:-.5}),new CatSimulator.Action("PLAY",{hunger:2,energy:-5,speed:.1}),new CatSimulator.Action("HUNT",{hunger:-5,energy:-5,speed:.05}),new CatSimulator.Action("PURR",{hunger:-.4,energy:-.4})]},CatSimulator.Cat={birthday:new Date,parameters:{speed:1,energy:15,hunger:0,age:0},born:function(){this.birthday.setHours(0),CatSimulator.UI.log("CAT_WAS_BORN"),this.takeAnAction()},getParameters:function(){return{speed:this.parameters.speed,energy:this.parameters.energy,hunger:this.parameters.hunger,age:this.parameters.age}},isAlive:function(){return this.parameters.energy>0&&this.parameters.hunger<25},survive:function(a){return{hunger:a.hunger+a.speed,age:a.age+1/a.speed,energy:a.energy-a.speed,speed:a.speed-a.age/1e4}},takeAnAction:function(){var a=CatSimulator.Actions.choose();this.parameters=this.survive(this.parameters),a.perform(),CatSimulator.UI.log(a.message),CatSimulator.UI.renderSidebar(),this.isAlive()?setTimeout(function(){CatSimulator.Cat.takeAnAction()},5e3):CatSimulator.UI.log("CAT_DIED")}},CatSimulator.Messages={DAY:"Day",HOUR:":00",CAT_WAS_BORN:"New Cat was born! Long live the Cat!",CAT_DIED:"Poor lazy Cat died. It was your fault!",SLEEP:"Cat gracefully sleeping.",EAT:"Cat violently eats some food. Food silently disappears.",PLAY:"Cat playing with optical mouse. Optical mouse strikes ferocious pose, its single eye glowing with fury.",HUNT:"Cat chasing down large angry cockroach. Angry cockroach babbling some nonsense of diverse pussies.",PURR:"Cat peacefully purrs."},CatSimulator.UI={chronicle:document.getElementById("chronicle"),sidebar:document.getElementById("sidebar"),log:function(a){a=CatSimulator.Messages.hasOwnProperty(a)?CatSimulator.Messages[a]:a;var b=document.createTextNode(a),c=document.createElement("p");c.className+="chronicle-entry",c.appendChild(this.time()),c.appendChild(b),this.chronicle.appendChild(c),this.chronicle.scrollTop=this.chronicle.scrollHeight},breaker:function(){return document.createElement("br")},time:function(){var a=document.createElement("span");return a.className+="chronicle-time",a.innerHTML=CatSimulator.Utils.getAge(),a},renderSidebar:function(){var a=CatSimulator.Cat.getParameters(),b=document.createDocumentFragment();sidebar.innerHTML="<pre>   ^-^<br/> =' . '=<br/></pre>";for(var c in a)if(a.hasOwnProperty(c)){var d=document.createElement("span");d.className+="sidebar-key",d.innerHTML=c,b.appendChild(d);var e=document.createElement("span");e.className+="sidebar-value",e.innerHTML=a[c].toFixed(2),b.appendChild(e)}sidebar.appendChild(b)}},CatSimulator.Utils={oneHour:36e5,oneDay:864e5,formatAge:function(a){return[CatSimulator.Messages.DAY,Math.ceil(a/this.oneDay),Math.ceil(a/this.oneHour%24)+CatSimulator.Messages.HOUR].join(" ")},getAge:function(){var a=new Date(CatSimulator.Cat.birthday);return a.setHours(a.getHours()+CatSimulator.Cat.parameters.age),this.formatAge(a-CatSimulator.Cat.birthday)}};